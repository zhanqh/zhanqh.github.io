<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Selenium 在爬虫的应用实例 | zhanqh</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Selenium 在爬虫的应用实例</h1><a id="logo" href="/.">zhanqh</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/data_observe.html"><i class="fa fa-line-chart"> 数据</i></a><a href="/archives/"><i class="fa fa-archive"> 笔记</i></a><a href="/app-bus.html"><i class="fa fa-mobile"> bus app</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Selenium 在爬虫的应用实例</h1><div class="post-meta">Jun 4, 2017<span> | </span><span class="category"><a href="/categories/爬虫/">爬虫</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本使用"><span class="toc-number">1.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#声明浏览器对象"><span class="toc-number">2.</span> <span class="toc-text">声明浏览器对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#访问页面"><span class="toc-number">3.</span> <span class="toc-text">访问页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查找元素"><span class="toc-number">4.</span> <span class="toc-text">查找元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单个元素"><span class="toc-number">4.1.</span> <span class="toc-text">单个元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多个元素"><span class="toc-number">4.2.</span> <span class="toc-text">多个元素</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#元素交互操作"><span class="toc-number">5.</span> <span class="toc-text">元素交互操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#交互动作"><span class="toc-number">6.</span> <span class="toc-text">交互动作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#执行-JavaScript"><span class="toc-number">7.</span> <span class="toc-text">执行 JavaScript</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取元素信息"><span class="toc-number">8.</span> <span class="toc-text">获取元素信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#获取属性值"><span class="toc-number">8.1.</span> <span class="toc-text">获取属性值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取文本值"><span class="toc-number">8.2.</span> <span class="toc-text">获取文本值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取ID、位置、标签名、大小"><span class="toc-number">8.3.</span> <span class="toc-text">获取ID、位置、标签名、大小</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frame"><span class="toc-number">9.</span> <span class="toc-text">Frame</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#等待"><span class="toc-number">10.</span> <span class="toc-text">等待</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#隐式等待"><span class="toc-number">10.1.</span> <span class="toc-text">隐式等待</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#显式等待"><span class="toc-number">10.2.</span> <span class="toc-text">显式等待</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前进后退"><span class="toc-number">11.</span> <span class="toc-text">前进后退</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookies"><span class="toc-number">12.</span> <span class="toc-text">Cookies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选项卡管理"><span class="toc-number">13.</span> <span class="toc-text">选项卡管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#异常处理"><span class="toc-number">14.</span> <span class="toc-text">异常处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改-user-agent"><span class="toc-number">15.</span> <span class="toc-text">修改 user-agent</span></a></li></ol></div></div><div class="post-content"><p>自动化测试，给浏览器发送各种指令，完成各种动作，用来解决 JavaScript 渲染问题</p>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</div><div class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</div><div class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</div><div class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line"><span class="keyword">try</span>:</div><div class="line">    browser.get(<span class="string">'https://www.baidu.com'</span>)</div><div class="line">    input = browser.find_element_by_id(<span class="string">'kw'</span>)</div><div class="line">    input.send_keys(<span class="string">'Python'</span>)</div><div class="line">    input.send_keys(Keys.ENTER)</div><div class="line">    wait = WebDriverWait(browser,<span class="number">10</span>)</div><div class="line">    wait.until(EC.presence_of_element_located((By.ID,<span class="string">'content_left'</span>)))</div><div class="line">    print(browser.current_url)</div><div class="line">    print(browser.get_cookies())</div><div class="line">    print(browser.page_source)</div><div class="line"><span class="keyword">finally</span>:</div><div class="line">    browser.close()</div></pre></td></tr></table></figure>
<h2 id="声明浏览器对象"><a href="#声明浏览器对象" class="headerlink" title="声明浏览器对象"></a>声明浏览器对象</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser = webdriver.Firefox()</div><div class="line">browser = webdriver.Edge()</div><div class="line">browser = webdriver.PhantomJS()</div><div class="line">browser = webdriver.webdriver.Safari()</div></pre></td></tr></table></figure>
<h2 id="访问页面"><a href="#访问页面" class="headerlink" title="访问页面"></a>访问页面</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</div><div class="line">print(browser.page_source)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<h2 id="查找元素"><a href="#查找元素" class="headerlink" title="查找元素"></a>查找元素</h2><h3 id="单个元素"><a href="#单个元素" class="headerlink" title="单个元素"></a>单个元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</div><div class="line">input_first = browser.find_element_by_id(<span class="string">'q'</span>)</div><div class="line">input_second = browser.find_element_by_css_selector(<span class="string">'#q'</span>)</div><div class="line">input_third = browser.find_element_by_xpath(<span class="string">'//*[@id="q"]'</span>)</div><div class="line">print(input_first,input_second,input_third,sep=<span class="string">'\n'</span>)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<ul>
<li>find_element_by_name</li>
<li>find_element_by_xpath</li>
<li>find_element_by_link_text</li>
<li>find_element_by_partial_link_text</li>
<li>find_element_by_tag_name</li>
<li>find_element_by_class_name</li>
<li>find_element_by_css_selector</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</div><div class="line">input_first = browser.find_element(By.ID,<span class="string">'q'</span>)</div><div class="line">print(input_first)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<h3 id="多个元素"><a href="#多个元素" class="headerlink" title="多个元素"></a>多个元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</div><div class="line">lis = browser.find_elements_by_css_selector(<span class="string">'.service-bd li'</span>)</div><div class="line">print(lis)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</div><div class="line">lis = browser.find_elements(By.CSS_SELECTOR, <span class="string">'.service-bd li'</span>)</div><div class="line">print(lis)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<ul>
<li>find_elements_by_name</li>
<li>find_elements_by_xpath</li>
<li>find_elements_by_link_text</li>
<li>find_elements_by_partial_link_text</li>
<li>find_elements_by_tag_name</li>
<li>find_elements_by_class_name</li>
<li>find_elements_by_css_selector</li>
</ul>
<h2 id="元素交互操作"><a href="#元素交互操作" class="headerlink" title="元素交互操作"></a>元素交互操作</h2><p>对获取的元素调用交互方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</div><div class="line">input = browser.find_element_by_id(<span class="string">'q'</span>)</div><div class="line">input.send_keys(<span class="string">'iPhone'</span>)</div><div class="line">time.sleep(<span class="number">1</span>)</div><div class="line">input.clear()</div><div class="line">input.send_keys(<span class="string">'iPad'</span>)</div><div class="line">button = browser.find_element_by_class_name(<span class="string">'btn-search'</span>)</div><div class="line">button.click()</div></pre></td></tr></table></figure>
<p><a href="http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.remote.webelement" target="_blank" rel="external">http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.remote.webelement</a></p>
<h2 id="交互动作"><a href="#交互动作" class="headerlink" title="交互动作"></a>交互动作</h2><p>将动作附加到动作链中串行执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span>)</div><div class="line">browser.switch_to.frame(<span class="string">'iframeResult'</span>)</div><div class="line">source = browser.find_element_by_css_selector(<span class="string">'#draggable'</span>)</div><div class="line">target = browser.find_element_by_css_selector(<span class="string">'#droppable'</span>)</div><div class="line">actions = ActionChains(browser)</div><div class="line">actions.drag_and_drop(source,target)</div><div class="line">actions.perform()</div></pre></td></tr></table></figure>
<p>更多操作：<a href="http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.common.action_chains" target="_blank" rel="external">http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.common.action_chains</a></p>
<h2 id="执行-JavaScript"><a href="#执行-JavaScript" class="headerlink" title="执行 JavaScript"></a>执行 JavaScript</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</div><div class="line">browser.execute_script(<span class="string">'window.scrollTo(0,document.body.scrollHeight)'</span>)</div><div class="line">browser.execute_script(<span class="string">'alert("拉到最底")'</span>)</div><div class="line">time.sleep(<span class="number">30</span>)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<h2 id="获取元素信息"><a href="#获取元素信息" class="headerlink" title="获取元素信息"></a>获取元素信息</h2><h3 id="获取属性值"><a href="#获取属性值" class="headerlink" title="获取属性值"></a>获取属性值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</div><div class="line">logo = browser.find_element_by_id(<span class="string">'zh-top-link-logo'</span>)</div><div class="line">print(logo)</div><div class="line">print(logo.get_attribute(<span class="string">'class'</span>))</div></pre></td></tr></table></figure>
<h3 id="获取文本值"><a href="#获取文本值" class="headerlink" title="获取文本值"></a>获取文本值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</div><div class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</div><div class="line">print(input.text)</div></pre></td></tr></table></figure>
<h3 id="获取ID、位置、标签名、大小"><a href="#获取ID、位置、标签名、大小" class="headerlink" title="获取ID、位置、标签名、大小"></a>获取ID、位置、标签名、大小</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</div><div class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</div><div class="line">print(input.id)</div><div class="line">print(input.location)</div><div class="line">print(input.tag_name)</div><div class="line">print(input.size)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<h2 id="Frame"><a href="#Frame" class="headerlink" title="Frame"></a>Frame</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> NoSuchElementException</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span>)</div><div class="line">browser.switch_to.frame(<span class="string">'iframeResult'</span>)</div><div class="line">source = browser.find_element_by_css_selector(<span class="string">'#draggable'</span>)</div><div class="line">print(source)</div><div class="line"><span class="keyword">try</span>:</div><div class="line">    logo = browser.find_element_by_class_name(<span class="string">'logo'</span>)</div><div class="line"><span class="keyword">except</span> NoSuchElementException:</div><div class="line">    print(<span class="string">'没有 LOGO'</span>)</div><div class="line">browser.switch_to.parent_frame()</div><div class="line">logo = browser.find_element_by_class_name(<span class="string">'logo'</span>)</div><div class="line">print(logo)</div><div class="line">print(logo.text)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<h2 id="等待"><a href="#等待" class="headerlink" title="等待"></a>等待</h2><h3 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h3><p>当使用了隐式等待执行测试的时候，如果 WebDriver 没有在 DOM 中找到元素，将继续等待，超出设定时间后则抛出找不到元素的异常，换句话说，当查找元素并有立即出现时隐式等待将等待一段时间再查找 DOM，默认的时间是 0</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.implicitly_wait(<span class="number">10</span>)</div><div class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</div><div class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</div><div class="line">print(input)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<h3 id="显式等待"><a href="#显式等待" class="headerlink" title="显式等待"></a>显式等待</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</div><div class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</div><div class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</div><div class="line">wait = WebDriverWait(browser,<span class="number">10</span>)</div><div class="line">input = wait.until(EC.presence_of_element_located((By.ID,<span class="string">'q'</span>)))</div><div class="line">button = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR,<span class="string">'.btn-search'</span>)))</div><div class="line">print(input,button)</div></pre></td></tr></table></figure>
<ul>
<li>title_is  标题是某内容</li>
<li>title_contains  标题包含某内容</li>
<li>presence_of_element_located  元素已加载出，传入定位元祖，如(By.ID, ‘q’)</li>
<li>visibility_of_element_located  元素可见，传入定位元祖</li>
<li>visibility_of  可见，传入元素对象</li>
<li>presence_of_all_elements_located  所有元素加载出</li>
<li>text_to_be_present_in_element  某个元素文本包含某个字</li>
<li>text_to_be_present_in_element_value  某个元素值包含某个字</li>
<li>invisibility_of_element_located  元素可见，传入定位元祖</li>
<li>element_to_be_clickable  元素可点击，传入定位元祖，如(By.CSS_SELECTOR,’.btn-search’)</li>
<li>staleness_of  判断一个元素是否还存在 DOM 中，可判断页面是否已经刷新</li>
<li>element_to_selected  元素是否可选择，传入元素对象</li>
<li>element_located_to_selected  元素是否可选择，传入定位元祖</li>
<li>element_selection_state_to_be  传入元素对象以及状态，相等返回 True，否则返回 False</li>
<li>element_located_selection_state_to_be  传入定位元祖以及状态，相等返回 True，否则返回 False</li>
<li>alert_is_present  是否出现 Alert</li>
</ul>
<p>参考文档：<a href="http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.support.expected_conditions" target="_blank" rel="external">http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.support.expected_conditions</a></p>
<h2 id="前进后退"><a href="#前进后退" class="headerlink" title="前进后退"></a>前进后退</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.baidu.com/'</span>)</div><div class="line">browser.get(<span class="string">'https://www.taobao.com/'</span>)</div><div class="line">browser.get(<span class="string">'https://www.python.org/'</span>)</div><div class="line">browser.back()</div><div class="line">time.sleep(<span class="number">1</span>)</div><div class="line">browser.forward()</div><div class="line">time.sleep(<span class="number">1</span>)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<h2 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</div><div class="line">print(browser.get_cookies())</div><div class="line">browser.add_cookie(&#123;<span class="string">'name'</span>:<span class="string">'name'</span>,<span class="string">'domain'</span>:<span class="string">'www.zhihu.com'</span>,<span class="string">'value'</span>:<span class="string">'zhan'</span>&#125;)</div><div class="line">print(browser.get_cookies())</div><div class="line">browser.delete_all_cookies()</div><div class="line">print(browser.get_cookies())</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<h2 id="选项卡管理"><a href="#选项卡管理" class="headerlink" title="选项卡管理"></a>选项卡管理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.baidu.com'</span>)</div><div class="line">browser.execute_script(<span class="string">'window.open()'</span>)</div><div class="line">print(browser.window_handles)</div><div class="line">browser.switch_to_window(browser.window_handles[<span class="number">1</span>])</div><div class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</div><div class="line">time.sleep(<span class="number">1</span>)</div><div class="line">browser.switch_to_window(browser.window_handles[<span class="number">0</span>])</div><div class="line">browser.get(<span class="string">'https://www.python.org'</span>)</div><div class="line">time.sleep(<span class="number">5</span>)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line">browser.get(<span class="string">'https://www.baidu.com'</span>)</div><div class="line">browser.find_element_by_id(<span class="string">'hello'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException,NoSuchElementException</div><div class="line"></div><div class="line">browser = webdriver.Chrome()</div><div class="line"><span class="keyword">try</span>:</div><div class="line">    browser.get(<span class="string">'https://www.baidu.com'</span>)</div><div class="line"><span class="keyword">except</span> TimeoutException:</div><div class="line">    print(<span class="string">'超时'</span>)</div><div class="line"><span class="keyword">try</span>:</div><div class="line">    browser.find_element_by_id(<span class="string">'hello'</span>)</div><div class="line"><span class="keyword">except</span> NoSuchElementException:</div><div class="line">    print(<span class="string">'没有该元素'</span>)</div><div class="line"><span class="keyword">finally</span>:</div><div class="line">    browser.close()</div></pre></td></tr></table></figure>
<p>详细文档：<a href="http://selenium-python.readthedocs.io/api.html#module-selenium.common.exceptions" target="_blank" rel="external">http://selenium-python.readthedocs.io/api.html#module-selenium.common.exceptions</a></p>
<h2 id="修改-user-agent"><a href="#修改-user-agent" class="headerlink" title="修改 user-agent"></a>修改 user-agent</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">from</span> selenium.webdriver.common.desired_capabilities <span class="keyword">import</span> DesiredCapabilities</div><div class="line"></div><div class="line"><span class="comment"># 设置 phantomjs.page.settings.userAgent 的值</span></div><div class="line">dcap = dict(DesiredCapabilities.PHANTOMJS)</div><div class="line">dcap[<span class="string">"phantomjs.page.settings.userAgent"</span>] = (</div><div class="line">    <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36"</span></div><div class="line">)</div><div class="line"></div><div class="line">browser = webdriver.PhantomJS(desired_capabilities=dcap)</div><div class="line">browser.set_window_size(<span class="number">1400</span>,<span class="number">900</span>)</div><div class="line"></div><div class="line"><span class="comment"># 检验方法一</span></div><div class="line">agent = browser.execute_script(<span class="string">"return navigator.userAgent"</span>)</div><div class="line">print(agent)</div><div class="line"><span class="comment"># 检验方法二</span></div><div class="line">browser.get(<span class="string">'http://httpbin.org/get'</span>)</div><div class="line">print(browser.page_source)</div><div class="line">browser.close()</div></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://blog.zhanqh.com/2017/06/04/Selenium 在爬虫中的应用实例/" data-id="cj4uyqy3d000knbrc68t47ord" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Python/">Python</a><a href="/tags/crawler/">crawler</a></div><div class="post-nav"><a href="/2017/06/05/Scrapy 的命令行工具/" class="pre">Scrapy 的命令行工具</a><a href="/2017/06/02/PyQuery 库基本使用/" class="next">PyQuery 库常见用法</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://blog.zhanqh.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/实践/">实践</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作/">工作</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/爬虫/">爬虫</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/工作笔记/" style="font-size: 15px;">工作笔记</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/hosts/" style="font-size: 15px;">hosts</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/h5/" style="font-size: 15px;">h5</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Charles/" style="font-size: 15px;">Charles</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/crawler/" style="font-size: 15px;">crawler</a> <a href="/tags/Scrapy/" style="font-size: 15px;">Scrapy</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">zhanqh.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>